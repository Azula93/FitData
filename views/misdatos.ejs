<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="/public/css/signin.css" rel="stylesheet">
    <link href="/public/css/styles.css" rel="stylesheet">
    <link href="/public/css/dashboard.css" rel="stylesheet">
    <meta name="generator" content="Hugo 0.87.0">
    <title>FitData</title>
</head>

<body>
    <div class="container-fluid d-flex flex-column min-vh-100 ">
        <%- include('navbar',{ user: user }) %>
            <main class="flex-grow-1 mt-5">
                <div class="container mt-3">
                    <section class="p-5">
                        <div
                            class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h2>Mis Datos</h2>
                            <h2>Bienvenid@:
                                <% if (user) { %>
                                    <span class="badge bg-success">
                                        <%= user.nombreUsuario %>
                                    </span>
                                    <% } %>
                            </h2>
                        </div>
                    </section>


                    <% if (datos.length > 0) { %>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>IMC</th>
                                    <th>ICC</th>
                                    <th>Gasto Energético</th>
                                    <th>Carbohidratos</th>
                                    <th>Proteínas</th>
                                    <th>Grasas</th>
                                    <th>VO2</th>
                                    <th>METS</th>
                                    <th>Expectativa de Vida</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% 
                                let groupedData = {};
                                datos.forEach(dato => {
                                    if (!groupedData[dato.data_set_id]) {
                                        groupedData[dato.data_set_id] = {};
                                    }
                                    Object.assign(groupedData[dato.data_set_id], dato);
                                });
                    
                                Object.keys(groupedData).forEach((dataSetId, index) => {
                                    let dato = groupedData[dataSetId];
                                %>
                                <tr id="data-row-<%= dataSetId %>">
                                    <td><%= index + 1 %></td>
                                    <td><%= dato.imc || 'N/A' %></td>
                                    <td><%= dato.icc || 'N/A' %></td>
                                    <td><%= dato.gasto_energetico || 'N/A' %></td>
                                    <td><%= dato.chos || 'N/A' %></td>
                                    <td><%= dato.proteinas || 'N/A' %></td>
                                    <td><%= dato.grasas || 'N/A' %></td>
                                    <td><%= dato.vo2 || 'N/A' %></td>
                                    <td><%= dato.mets || 'N/A' %></td>
                                    <td><%= dato.expect_vida || 'N/A' %></td>
                                    <td>
                                        <button class="btn btn-danger btn-sm delete-btn" data-id="<%= dataSetId %>">Eliminar</button>
                                    </td>
                                </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    <% } else { %>
                        <p>No hay datos disponibles.</p>
                    <% } %>
                    
               

                                <div class="p-3">
                                    <a class="btn btn-primary " href="/generar-pdf" target="_blank">Generar PDF</a>
                                </div>
                                <script>
                                    function generarPDF() {
                                        window.location.href = '/generar-pdf';
                                    }
                                </script>

                                <%- include('footer',{ user: user }) %>
                </div>
            </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/52b9ec387c.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/public/js/delete.js"></script>
    <!-- <script  type="module" src="/public/js/datoscombinados.js"></script> -->
</body>

</html>